-- HELPER: LOAD PYWAL COLORS AUTOMATICALLY
function conky_load_pywal_colors()
    local handle = io.popen("sed -n '1,6p' ~/.cache/wal/colors")
    local colors = {}
    if handle then
        for line in handle:lines() do
            table.insert(colors, line)
        end
        handle:close()
    end
    if #colors < 5 then
        return {"#ffffff", "#ff0000", "#00ff00", "#0000ff", "#ffff00", "#ff00ff"}
    end
    return colors
end

local p = conky_load_pywal_colors()

conky.config = {
    -- Window Settings (FIXES FOR OVERLAY & BLUR)
    own_window = true,
    own_window_class = 'ConkySidebar',
    own_window_type = 'override',      -- Forces Conky behind windows
    own_window_hints = 'undecorated,below,sticky,skip_taskbar,skip_pager',
    own_window_transparent = true,
    own_window_argb_visual = true,
    own_window_argb_value = 255,

    -- PERFECT RIGHT-MIDDLE ALIGNMENT
    alignment = 'middle_right',
    gap_x = 30,
    gap_y = 0, 
    minimum_width = 300,
    maximum_width = 300,
    border_inner_margin = 20, 
    border_outer_margin = 0,

    -- Font & Text (BOLDER STYLE)
    font = 'Maple Mono NF:style=ExtraBold:size=10.5',
    use_xft = true,
    xftalpha = 1,
    uppercase = false,
    override_utf8_locale = true,
    draw_shades = false,

    -- Colors
    default_color = 'white',
    color0 = p[1],
    color1 = p[2], 
    color2 = p[3],
    color3 = p[5], 

    -- Graphics & Performance
    draw_graph_borders = true,
    update_interval = 1.0, 
    double_buffer = true,
    no_buffers = true,
}

conky.text = [[
${color1}${font Maple Mono NF:style=Black:size=14.5}󱑎 SYSTEM ${hr 2}${font}${color}
${voffset 5}
${alignc}${font Maple Mono NF:style=Black:size=30.5}${time %I:%M %p}${font}
${alignc}${font Maple Mono NF:style=Black:size=12.5}${time %A, %d %B}${font}
${voffset 10}
${color1}Uptime:${alignr}${color}${uptime}
${color1}CPU Freq:${alignr}${color}${freq_g} GHz

${color1}${font Maple Mono NF:style=Black:size=12.5} WEATHER (Rajshahi) ${hr 2}${font}${color}
${voffset 5}
${color1}Condition:${alignr}${color}${execi 1800 curl -s 'wttr.in/Rajshahi?format=%C' | sed 's/ //g'}
${color1}Temp:${alignr}${color}${execi 1800 curl -s 'wttr.in/Rajshahi?format=%t'}
${color1}Humidity:${alignr}${color}${execi 1800 curl -s 'wttr.in/Rajshahi?format=%h'}

${color1}${font Maple Mono NF:style=Black:size=12.5}󰢮 GPU ${hr 2}${font}${color}
${voffset 5}
${color1}Usage:${alignr}${color}${execi 5 nvidia-smi --query-gpu=utilization.gpu --format=csv,noheader,nounits}%
${color1}Temp:${alignr}${color}${execi 5 nvidia-smi --query-gpu=temperature.gpu --format=csv,noheader,nounits}°C
${color1}VRAM:${alignr}${color}${execi 5 nvidia-smi --query-gpu=memory.used --format=csv,noheader}${color1} / ${color}${execi 5 nvidia-smi --query-gpu=memory.total --format=csv,noheader}

${color1}${font Maple Mono NF:style=Black:size=12.5} STORAGE ${hr 2}${font}${color}
${voffset 5}
${color1}Home (/home):${alignr}${color}${fs_used /home} / ${fs_size /home}
${color3}${fs_bar 10,260 /home}${color}
${voffset 10}
${color1}Read Speed:${alignr}${color}${diskio_read}
${color3}${diskiograph_read 30,260}${color}
${color1}Write Speed:${alignr}${color}${diskio_write}
${color3}${diskiograph_write 30,260}${color}

${color1}${font Maple Mono NF:style=Black:size=12.5} TOP PROCESSES ${hr 2}${font}${color}
${voffset 5}
${color1}Name${goto 180}CPU%${alignr}RAM%${color}
${top name 1}${goto 180}${top cpu 1}%${alignr}${top mem 1}%
${top name 2}${goto 180}${top cpu 2}%${alignr}${top mem 2}%
${top name 3}${goto 180}${top cpu 3}%${alignr}${top mem 3}%
${top name 4}${goto 180}${top cpu 4}%${alignr}${top mem 4}%
]]
